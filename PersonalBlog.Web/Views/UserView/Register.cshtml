@{
    ViewData["Title"] = "Регистрация";
    Layout = "_Layout";
}

<h2>Регистрация</h2>
<input type="text" id="login" placeholder="Логин" class="form-control mb-2"/>
<input type="text" id="nickname" placeholder="Никнейм" class="form-control mb-2"/>
<input type="text" id="email" placeholder="Email" class="form-control mb-2"/>
<input type="password" id="password" placeholder="Пароль" class="form-control mb-2"/>
<button class="btn btn-primary" onclick="doRegister()">Зарегистрироваться</button>

<script>
async function doRegister() {
    const login = document.getElementById("login").value.trim();
    const nickname = document.getElementById("nickname").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    // --- Клиентская валидация ---
    let errors = [];

    if (login.length < 3) errors.push("Логин должен содержать минимум 3 символа");
    if (nickname.length < 2) errors.push("Никнейм должен содержать минимум 2 символа");
    if (!/^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/.test(email)) errors.push("Некорректный email");
    if (password.length < 6) errors.push("Пароль должен быть не короче 6 символов");

    if (errors.length > 0) {
        alert("Исправьте ошибки:\n- " + errors.join("\n- "));
        return;
    }

    // --- Отправка на сервер ---
    const dto = { Login: login, Nickname: nickname, Email: email, Password: password };

    const res = await fetch("/userapi/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(dto)
    });

    if (res.ok) {
        alert("Пользователь создан");
        window.location.href = "/AccountView/Login";
    } else {
        const err = await res.json();
        alert("Ошибка регистрации: " + JSON.stringify(err));
    }
}
</script>