@{
    ViewData["Title"] = "Редактировать тег";
    Layout = "_Layout";
}

<h2>Редактировать тег</h2>
<input type="text" id="tagName" class="form-control mb-2" placeholder="Название тега" />
<button class="btn btn-primary" onclick="saveTag()">Сохранить</button>
<a href="/TagView/TagList">Перейти к списку всех тегов</a>

<script>
    function getQueryParam(param) {
        return new URLSearchParams(window.location.search).get(param);
    }

    async function loadTag() {
        const tagId = getQueryParam("tagId");
        if (!tagId) {
            alert("Не найден ID тега");
            return;
        }

        const res = await fetch("/tagapi/" + tagId);
        if (res.ok) {
            const tag = await res.json();
            document.getElementById("tagName").value = tag.name;
        } else {
            alert("Ошибка при загрузке тега");
        }
    }

    async function saveTag() {
        const tagId = getQueryParam("tagId");
        const name = document.getElementById("tagName").value.trim();

        if (!name) {
            alert("Введите название тега");
            return;
        }

        await fetch("/tagapi/edit/" + tagId, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name })
        });

        alert("Тег обновлён");
        window.location.href = "/TagView/TagList";
    }
    
    loadTag();
</script>